buildPack: none
pipelineConfig:
  pipelines:
    pullRequest:
      pipeline:
        agent:
          image: gcr.io/jenkinsxio/builder-terraform:2.0.1080-413
        stages:
          options:
            volumes:
            - name: sa
              secret:
                secretName: terraform-secret
                items:
                - key: ci_sa
                  path: sa/ci_bot.json
            containerOptions:
              volumeMounts:
              - mountPath: /secret
                name: sa
        - name: ci
          steps:
          - name: terraform-version
            command: terraform
            args:
            - -version
          - name: terraform-init
            command: terraform
            args:
            - init
          - name: terraform-fmt
            command: terraform
            args:
            - fmt
            - -check
          - name: terraform-validate
            command: terraform
            args:
            - validate
          - name: run-ci-checks
            command: ./ci.sh
